stages:
  - deploy

deploy:
  stage: deploy
  tags:
    - shell
  variables:
    PROJECT_DIR: "/home/root/projects/bisp-13292"
  script:
    - echo "Starting deployment..."
    - |
      if [ ! -d "$PROJECT_DIR" ]; then
        echo "❌ Directory $PROJECT_DIR does not exist"
        exit 1
      fi
    - cd $PROJECT_DIR
    - echo "✅ Pulling latest changes..."
    - git pull origin main || { echo "❌ Git pull failed"; exit 1; }
    - echo "✅ Stopping existing containers..."
    - docker compose down || { echo "❌ Docker compose down failed"; exit 1; }
    - echo "✅ Starting new containers..."
    - docker compose up -d --build || { echo "❌ Docker compose up failed"; exit 1; }
    - echo "✅ Deployment completed successfully"
  only:
    - main